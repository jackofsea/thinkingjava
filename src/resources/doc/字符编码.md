# 字符编码

## 1.字符编码发展历史

​       由美国发明计算机，制定 ASCII 码（American Standard Code for Information Interchange，美国信息互换标准代码），总共有 128 个，字节最高为0，用一个字节的低 7 位表示，0~31 是控制字符如换行回车删除等；32~126 是打印字符，可以通过键盘输入并且能够显示出，当时世界上所有的计算机都用同样的ASCII方案来保存英文文字。 

​    后来，其他国家开始使用计算机，对ASCII进行扩展，字节最高为1，最终扩展了的255个字符，从128到255这一页的字符集被称”扩展字符集”。

​    等中国人们得到计算机时，已经没有可以利用的字节状态来表示汉字，况且有6000多个常用汉字需要保存呢。但是这难不倒智慧的中国人民，我们不客气地把那些127号之后的奇异符号们直接取消掉, 规定：一个小于127的字符的意义与原来相同，但两个大于127的字符连在一起时，就表示一个汉字，前面的一个字节（他称之为高字节）从0xA1用到0xF7，后面一个字节（低字节）从0xA1到0xFE，这样我们就可以组合出大约7000多个简体汉字了。在这些编码里，我们还把数学符号、罗马希腊的字母、日文的假名们都编进去了，连在 ASCII 里本来就有的数字、标点、字母都统统重新编了两个字节长的编码，这就是常说的”全角”字符，而原来在127号以下的那些就叫”半角”字符了。 

   中国人民看到这样很不错，于是就把这种汉字方案叫做 “GB2312”。GB2312 是对 ASCII 的中文扩展。  

​    但是中国的汉字太多了，我们很快就就发现有许多人的人名没有办法在这里打出来，特别是某些很会麻烦别人的国家领导人。于是我们不得不继续把 GB2312 没有用到的码位找出来老实不客气地用上。

​    后来还是不够用，于是干脆不再要求低字节一定是127号之后的内码，只要第一个字节是大于127就固定表示这是一个汉字的开始，不管后面跟的是不是扩展字符集里的内容。结果扩展之后的编码方案被称为 GBK 标准，GBK 包括了 GB2312 的所有内容，同时又增加了近20000个新的汉字（包括繁体字）和符号。 

​    后来少数民族也要用电脑了，于是我们再扩展，又加了几千个新的少数民族的字，GBK 扩成了 GB18030。从此之后，中华民族的文化就可以在计算机时代中传承了。  

由于字符集越来越来多，给交流带来巨大的阻碍,ISO （国际标谁化组织）的国际组织决定着手解决这个问题。他们采用的方法很简单：废了所有的地区性编码方案，重新搞一个包括了地球上所有文化、所有字母和符号的编码！他们打算叫它”Universal Multiple-Octet Coded Character Set”，简称 UCS, 俗称 “UNICODE”。



## 2.关键概念

### 字符[character]

字符代表了字母表中的字符，标点符号和其他的一些符号。在计算机中，文本是由字符组成的。

### 字符集合[character set]

由一套用于特定用途的字符组成，例如支持西欧语言的字符集合，支持中文的字符集合。字符集合只定义了符号和他们的语意，其实跟计算机没有直接关系。

现实生活中，不同的语系有自己的字符集合，例如藏文有自己的字符集合，汉文有自己的字符集合。到计算机的世界中，也有各种字符集合，例如[ASCII字符集合](http://zh.wikipedia.org/zh/ASCII)，[GB2312字符集合](http://zh.wikipedia.org/zh/GB_2312)，[GBK字符集合](http://zh.wikipedia.org/zh/%E6%B1%89%E5%AD%97%E5%86%85%E7%A0%81%E6%89%A9%E5%B1%95%E8%A7%84%E8%8C%83)。还有一个其他字符集合的超集--[Unicode字符集](http://zh.wikipedia.org/wiki/Unicode)定义了几乎绝大部分现存语言需要的字符，是一种通用的字符集，来支持多语言环境(可以同时处理多种语言混合的情况）。各个国家和地区在制定编码标准的时候，“字符集合”和“字符编码”一般都是同时制定的。所以像ASCII字符集合一样，它也同时代表了一种字符的编码。

### 字符编码[character encoding]

​    是一套规则，定义了在计算机内存中如何表示字符，是字符集中的每个字符与计算机内存中字节之间的转换关系，也可以认为是把字符数字化，规定每个“字符”分别用一个字节还是多个字节存储，用哪些字节来存储。例如ASCII编码[你没看错，它既是一种字符集合，也是一种字符编码]，定义了英文字母和符号在计算机中的表示方式，是用一个字节来表示。Unicode字符集合，有好几种字符编码方式，例如变长度编码的[UTF8](http://zh.wikipedia.org/zh/UTF-8)，[UTF16](http://zh.wikipedia.org/zh/UTF-16)等。中文字符集也有很多字符编码，例如上文提到的GB2312编码，GBK编码等。



**在计算机内存中，统一使用Unicode编码，当需要保存到硬盘或者需要传输的时候，就转换编码。**



## 3.字符集合

### Unicode

   Unicode使用十六进制来表示，采用两个字节表示一个字符，两个字节就是16位长度的二进制，如果不考虑符号位则最大可以表示 2的16次方即65536个码点（两个字节的二进制共65536个数），码点是指Unicode编码表中一个字符所对应的代码值。大写英文字母A，其ASCII值为97，如果用Unicode表示则是\u0041。

​     其实，65536的码点并不能表示全世界的字符，于是Unicode就增补了一部分字符，目前的Unicode分为17组编排，每组称为平面（Plane），而每平面拥有65536个码点，最初的65536个字符在0号平面，增补的字符大多在1号平面，1号平面的字符就需要四个字节进行存储，目前很多平面还没有使用。

​     说到这里可以知道，Unicode就是一个字符集，这个字符集旨在统一全世界的所有字符，基本的字符用十六进制两个字节来表示，两个字节最多表示65536个码点，不能表示全世界的所有字符，于是就增补了一些码点，增补的码点需要四个字节来表示。

​     **在Java（其中主要包括在JVM中、内存中、在代码里声明的每一个char、String类型的变量中。）中字符只以一种形式存在，那就是Unicode，不选择任何特定的编码，直接使用它们在字符集中的编号，这是统一的唯一的方法。**
​     **在JVM内部，统一使用Unicode表示，当着字符从JVM内部移动到外部时（即保存为文件系统中的一个文件内容时），就进行了编码转换，使用了具体的编码方案。因此也可以说，所有的编码转换只发生在边界的地方，也就是各种输入/输出流的起作用的地方。**

### GB2312

​    GB2312编码为了避免与ASCII字符编码(0~127)相冲突，规定表示一个汉字的编码(即汉字内码)的字节其值必须大于127(即字节的最高位为1)，并且必须是两个大于127的字节连在一起来共同表示一个汉字(GB2312为双字节编码)，前一字节称为高字节，后一字节称为低字节；而一个字节的值若小于127(即字节的最高位为0)，自然是仍表示一个原来的ASCII字符(ASCII为单字节编码)。

   因此，可以认为GB2312是对ASCII的中文扩展(即GB2312与ASCII相兼容)，正如EASCII是对ASCII的欧洲文字扩展一样。

​    不过，很显然的是，GB2312与EASCII码的128~255这段扩展部分所表示的字符是不同的。也就是说，GB2312与EASCII虽然都兼容ASCII，但GB2312并不兼容EASCII的扩展部分。

  事实上，目前世界上除ASCII之外的其它通行的字符编码方案，基本上都兼容ASCII，但相互之间并不兼容。

### GBK

​    GBK跟GB2312一样是双字节编码，然而，GBK只要求第一个字节即高字节是大于127就固定表示这是一个汉字的开始(0~127当然表示的还是ASCII字符)，不再要求第二个字节即低字节也必须是127号之后的编码。这样，作为同样是双字节编码的GBK才可以收录比GB2312更多字符。

​    GBK字符集向后完全兼容GB2312，还支持GB2312-1980不支持的部分中文简体、中文繁体、日文假名，还包括希腊字母以及俄语字母等字母(不过这个编码不支持韩国文字，也是其在实际使用中与Unicode编码相比欠缺的部分)，共收录汉字21003个、符号883个，并提供1894个造字码位，简、繁体字融于一体。

### GB18030

​     **GB 18030**，全称《信息技术 中文编码字符集》，是[中华人民共和国](https://baike.baidu.com/item/%E4%B8%AD%E5%8D%8E%E4%BA%BA%E6%B0%91%E5%85%B1%E5%92%8C%E5%9B%BD)[国家标准](https://baike.baidu.com/item/%E5%9B%BD%E5%AE%B6%E6%A0%87%E5%87%86)所规定的变长多字节字符集。其对GB 2312-1980完全向后兼容]，与[GBK](https://baike.baidu.com/item/GBK)基本向后兼容，并支持[Unicode](https://baike.baidu.com/item/Unicode)（GB 13000）的所有码位。GB 18030共收录汉字70,244个。

GB 18030主要有以下特点 [ ：

- 采用变长多字节编码，每个字可以由1个、2个或4个字节组成。
- 编码空间庞大，最多可定义161万个字符。
- 完全支持Unicode，无需动用造字区即可支持中国国内少数民族文字、中日韩和繁体汉字以及[emoji](https://baike.baidu.com/item/emoji)等字符。

这个虽然是国家标准，但是实际应用系统中使用的并不广泛。

### ISO-8859-1

​      ISO-8859-1编码是单字节编码，向下兼容ASCII，其编码范围是0x00-0xFF，0x00-0x7F之间完全和ASCII一致，0x80-0x9F之间是[控制字符](https://baike.baidu.com/item/%E6%8E%A7%E5%88%B6%E5%AD%97%E7%AC%A6/6913704)，0xA0-0xFF之间是文字符号。

​     此字符集支持部分于欧洲使用的语言，包括[阿尔巴尼亚语](https://baike.baidu.com/item/%E9%98%BF%E5%B0%94%E5%B7%B4%E5%B0%BC%E4%BA%9A%E8%AF%AD/1190175)、[巴斯克语](https://baike.baidu.com/item/%E5%B7%B4%E6%96%AF%E5%85%8B%E8%AF%AD/6715189)、[布列塔尼语](https://baike.baidu.com/item/%E5%B8%83%E5%88%97%E5%A1%94%E5%B0%BC%E8%AF%AD/7533069)、加泰罗尼亚语、丹麦语、[荷兰语](https://baike.baidu.com/item/%E8%8D%B7%E5%85%B0%E8%AF%AD/676102)、[法罗语](https://baike.baidu.com/item/%E6%B3%95%E7%BD%97%E8%AF%AD/3527684)、[弗里西语](https://baike.baidu.com/item/%E5%BC%97%E9%87%8C%E8%A5%BF%E8%AF%AD)、[加利西亚语](https://baike.baidu.com/item/%E5%8A%A0%E5%88%A9%E8%A5%BF%E4%BA%9A%E8%AF%AD/7565939)、德语、[格陵兰语](https://baike.baidu.com/item/%E6%A0%BC%E9%99%B5%E5%85%B0%E8%AF%AD/9707580)、[冰岛语](https://baike.baidu.com/item/%E5%86%B0%E5%B2%9B%E8%AF%AD/3937406)、[爱尔兰盖尔语](https://baike.baidu.com/item/%E7%88%B1%E5%B0%94%E5%85%B0%E7%9B%96%E5%B0%94%E8%AF%AD/159779)、意大利语、拉丁语、[卢森堡语](https://baike.baidu.com/item/%E5%8D%A2%E6%A3%AE%E5%A0%A1%E8%AF%AD/7625675)、[挪威语](https://baike.baidu.com/item/%E6%8C%AA%E5%A8%81%E8%AF%AD/2186154)、葡萄牙语、里托罗曼斯语、[苏格兰盖尔语](https://baike.baidu.com/item/%E8%8B%8F%E6%A0%BC%E5%85%B0%E7%9B%96%E5%B0%94%E8%AF%AD/7645288)、西班牙语及瑞典语。

## 4.编码方案

### UTF-8

​    UTF-8以字节为单位对Unicode进行编码。从Unicode到UTF-8的编码方式如下：

| **Unicode编码(十六进制)** | **UTF-8 字节流(二进制)**            |
| ------------------------- | ----------------------------------- |
| 000000-00007F             | 0xxxxxxx                            |
| 000080-0007FF             | 110xxxxx 10xxxxxx                   |
| 000800-00FFFF             | 1110xxxx 10xxxxxx 10xxxxxx          |
| 010000-10FFFF             | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx |

​    UTF-8的特点是对不同范围的字符使用不同长度的编码。对于0x00-0x7F之间的字符，UTF-8编码与[ASCII编码](https://baike.baidu.com/item/ASCII%E7%BC%96%E7%A0%81)完全相同。UTF-8编码的最大长度是4个字节。从上表可以看出，4字节模板有21个x，即可以容纳21位二进制数字。Unicode的最大码位0x10FFFF也只有21位。

​    例1：“汉”字的Unicode编码是0x6C49。0x6C49在0x0800-0xFFFF之间，使用3字节模板：1110xxxx 10xxxxxx 10xxxxxx。将0x6C49写成二进制是：0110 1100 0100 1001， 用这个比特流依次代替模板中的x，得到：11100110 10110001 10001001，即E6 B1 89。

   例2：Unicode编码0x20C30在0x010000-0x10FFFF之间，使用4字节模板：11110xxx 10xxxxxx 10xxxxxx 10xxxxxx。将0x20C30写成21位二进制数字（不足21位就在前面补0）：0 0010 0000 1100 0011 0000，用这个比特流依次代替模板中的x，得到：11110000 10100000 10110000 10110000，即F0 A0 B0 B0。



### UTF-16

UTF-16 使用变长字节表示 

① 对于编号在 U+0000 到 U+FFFF 的字符（常用字符集），直接用两个字节表示。 
② 编号在 U+10000 到 U+10FFFF 之间的字符，需要用四个字节表示。

同样，UTF-16 也有字节的顺序问题（大小端），所以就有 UTF-16BE 表示大端，UTF-16LE 表示小端。

### GB2312

 GB2312既是字符集合也是编码方案

### GBK

 GBK既是字符集合也是编码方案

### GB18030

 GB18030既是字符集合也是编码方案



**目前使用最多的UTF-8**

## 5.编程语言中的应用

### JAVA

​     在Java（其中主要包括在JVM中、内存中、在代码里声明的每一个char、String类型的变量中。）中字符只以一种形式存在，那就是Unicode，不选择任何特定的编码，直接使用它们在字符集中的编号，这是统一的唯一的方法。
​     在JVM内部，统一使用Unicode表示，当着字符从JVM内部移动到外部时（即保存为文件系统中的一个文件内容时），就进行了编码转换，使用了具体的编码方案。因此也可以说，所有的编码转换只发生在边界的地方，也就是各种输入/输出流的起作用的地方。